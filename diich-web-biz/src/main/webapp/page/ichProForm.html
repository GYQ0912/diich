<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>我要申报-项目表单</title>
    <link rel="stylesheet" href="/assets/css/common.css">
    <link rel="stylesheet" href="/assets/css/inputs.css">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/system.js"></script>
	<script src="/assets/js/serverinfo.js"></script>
    <script src="/assets/js/inputs.js"></script>
	<script src="/assets/js/ajaxfileupload.js"></script>
	
	<script src="http://192.168.1.111/category.js"></script>
    <script src="http://192.168.1.111/citys.js"></script>
    <script src="http://192.168.1.111/keyword.js"></script>
</head>

<body style="background-color: rgb(245, 246, 247)">
<div class="header fixed header_detail"></div>
<!--//End header-->

<div class="container ipt_base">
    <div class="project">
        <div class="hd">
            <div class="name">填写申报信息-土家银器</div>
            <div class="handle">
                <a class="active" href="">保存</a>
                <a class="active" href="">已保存</a>
                <a class="empty" href="">预览</a>
                <a class="empty" href="">提交</a>
            </div>
        </div>
    </div>
    <!--//End project_name-->

    <div class="hd">
        <div class="slide_nav">
            <dl>
                <dt><i class="checkbox"></i><span>基础信息</span></dt>
            </dl>
            <!--//End 基础信息-->
            <dl>
                <dt><i class="checkbox"></i><span>项目内容</span><em></em></dt>
                <dd>
                    <ul>
                        <li class="active"><a href=""><i class="checkbox"></i><span>基本内容</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>传承谱系</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>历史渊源</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>主要价值</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>基本特征</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>濒危状况</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>保护措施</span></a></li>
                    </ul>
                </dd>
            </dl>
            <!--//End 项目内容-->
            <dl>
                <dt><i class="checkbox"></i><span>项目实践</span><em></em></dt>
                <dd>
                    <ul>
                        <li><a href=""><i class="checkbox"></i><span>花样或图案</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>工具</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>制作技术、方法、过程撒打算的</span></a></li>
                        <li><a href=""><i class="checkbox"></i><span>代表作品</span></a></li>
                    </ul>
                </dd>
            </dl>


        </div>
        <div class="content">
            <div class="title"><h2>基础信息</h2></div>
            <!--//End-->
            <div class="bd base_tips">
                <p>· 标有<em class="red"> * </em>的为必填项</p>
                <p>· 信息越完善，申报成功的几率越高</p>
            </div>
            <!--//End-->
            <form class="base" action="">
				<input id="ichCategoryId" name="ichCategoryId" type="hidden" value=""/>
				<input id="titu" name="titu" type="hidden" value=""/>
				<input id="dis_code" name="dis_code" type="hidden" value=""/>
				<input id="chiName" name="chiName" type="hidden" value=""/>

                <div class="con">

                    <dl class="thematic">
                        <dt><em class="red">*</em>题图</dt>
                        <dd>
                            <div class="file"><input id="previewImg" onchange="Image.previewImage(this)" type="file">上传题图<img id="imghead" src="assets/uploads/exp1.png" width="296" height="222" onclick="$('#previewImg').click();"></div>
                            <p class="ipt_tips">建议比例：x*x，不符合的图片将进行裁剪；格式：jpg\png</p>
                        </dd>
                    </dl>
                    <!--//End 题图z-->
                    <dl>
                        <dt><em class="red">*</em>分类</dt>
                        <dd><a href="javascript:;" class="ipt" data-type="cate" id="categoryID">一级分类</a><i class="arrow_right"></i></dd>
                    </dl>
                    <!--//End 分类-->
                    <dl>
                        <dt><em class="red">*</em>地域</dt>
                        <dd>
                            <input class="ipt" type="text">
                            <p class="ipt_tips">多个地区用逗号隔开。如：中国江苏省苏州市，中国江苏省无锡市</p>
                        </dd>
                    </dl>
                    <!--//End 地域-->
                    <dl>
                        <dt><em class="red">*</em>是否为中国文化部认定的非遗项目？</dt>
                        <dd>
                            <div class="bd judge">
                                <span><i class="radio" name="rz"  value="0"></i>是</span>
                                <span><i class="radio" name="rz"  value="1"></i>否</span>
                            </div>
                            <div class="bd judge_drop">
                                <div class="item">
                                    <p>认证时间</p>
                                    <input type="text" id="certTime" name="certTime" value="">
                                </div>
                                <div class="item">
                                    <p>认定级别</p>
                                    <select id="select">
                                       
                                    </select>
                                </div>
                                <div class="item">
                                    <p>认证编号</p>
                                    <input type="text" value="" id="certCode" name="certCode">
                                </div>
                            </div>
                        </dd>
                    </dl>
                    <!--//End 是否为中国文化部认定的非遗项目-->
                    <dl class="brief">
                        <dt><em class="red">*</em>简介</dt>
                        <dd>
                            <textarea name="summary" id="summary" cols="30" rows="10"></textarea>
                        </dd>
                    </dl>
                    <!--//End 简介-->
                    <div class="bd info" id="tagContent">
                        <dl>
                            <dt><em class="red">*</em>拼音</dt>
                            <dd><input type="text" class="ipt" id="pinyin" name="pinyin"></dd>
                        </dl>
                        <dl>
                            <dt>别称</dt>
                            <dd><input type="text" class="ipt"></dd>
                        </dl>
                        <dl>
                            <dt>英文名</dt>
                            <dd><input type="text" class="ipt" id="engName" name="engName"></dd>
                        </dl>
                        <dl>
                            <dt>&nbsp;</dt>
                            <dd><a href="" class="ipt ipt_add">+添加新信息</a></dd>
                        </dl>
                    </div>
                    <!--//End 添加信息部分-->
                </div>
                <div class="bd save">
                    <input type="button" id="button" name ="button" value="保存并下一步" onclick="save()">
                </div>
            </form>
        </div>
    </div>
</div>


<div class="footer"></div>
<!--//End-->


<div class="project_layer">
    <div class="content">
        <div class="title">选择项目类别</div>
        <div class="items">
            <ul>
                <li><i class="radio" value="1" name="radio"></i>口头传说和表述</li>
                <li><i class="radio" value="11" name="radio"></i>表演艺术</li>
                <li><i class="radio" value="28" name="radio"></i>传统的手艺技能</li>
                <li><i class="radio" value="55" name="radio"></i>社会风俗、利益、节庆</li>
                <li><i class="radio" value="77" name="radio"></i>有关自然界和宇宙的只是和实践</li>
            </ul>
        </div>
        <div class="confirm">
            <a href="javascript:;" class="btn">确认</a>
        </div>
    </div>
</div>




</body>
<script>
    $(function () {
        $('.header .content .nav li').eq(6).addClass('active').siblings('li').removeClass('active');
        projectFrom.init();
		
		//初始化认证级别 数据
		
		$.ajax({
                cache: true,
                type: "POST",
                url: serverPath+"/dictionary/getCrtLevelList",
                dataType: "json",
                async: false,
                error: function(request) {
                    //alert("Connection error");
                },
                success: function(data) {
				
					if(data.msg=='SUCCESS'){
						var html="";
						$.each(data.data,function(index,item){
							html+="<option value=\""+item.id+"\" >"+item.name+"</option >";
						});
					
						$("#select").append(html);
					
					}else{
						alert("加载认证级别数据失败！");
					}
                  
                }
            });
		
    });
	
	function ajaxfileupload(fileid){
	
	
		$.ajaxFileUpload({
            url : '../user/uploadFile',
            secureuri : false,
            fileElementId : fileid,
            dataType : 'json',
            success : function(data) {
                if(data.code != 0) {
                    alert(data.msg);
                    return;
                }

                var arr = data.data;
                for(var i = 0; i < arr.length; i ++) {
                    var $img = $('<img style="width: 50px;"/>');
                    $img.attr('src', arr[i]);
                    $('#img_block').append($img);
                }
            },
            error : function(e) {
                alert(e.responseText);
            }
        });
		
	}
	
	function save(){
	

		//组织json 数据 
		//属性id
		var ich={}; //主对象
		var attr={};//contentFragment 内部属性对象
		
		var contentFragmentList=[];
		var contentFragment={};
		
		
		ich.ichCategoryId=$("#ichCategoryId").val(); //分类id

		//整合 固定字段 
		contentFragment.attributeId=1;//题图
		contentFragment.content=$("#titu").val();//题图对应链接
		
		attr.dataType=0;
		contentFragment.attribute=attr;
		
		contentFragmentList.push(contentFragment);
		
		//申报地区
		contentFragment.attributeId=33;//申报地区
		contentFragment.content=$("#dis_code").val();
		attr.dataType=101;
		
		contentFragment.attribute=attr;
		contentFragmentList.push(contentFragment);
		
		
		contentFragment.attributeId=4;//中文名
		contentFragment.content=$("#chiName").val();//中文名
		
		attr.dataType=0;
		contentFragment.attribute=attr;
		contentFragmentList.push(contentFragment);
		
		contentFragment.attributeId=9;//简介
		contentFragment.content=$("#summary").val();
		attr.dataType=1;//长文本
		
		contentFragment.attribute=attr;
		contentFragmentList.push(contentFragment);
		
		contentFragment.attributeId=6;//拼音
		contentFragment.content=$("#pinyin").val();
		attr.dataType=0;//短文本
		
		contentFragment.attribute=attr;
		contentFragmentList.push(contentFragment);
		
		
		contentFragment.attributeId=5;//英文名
		contentFragment.content=$("#engName").val();
		attr.dataType=0;//短文本
		
		contentFragment.attribute=attr;
		contentFragmentList.push(contentFragment);
		
		//判断是否 为已经认证项目

		
		
		var val=$('input:radio[name="rz"]:checked').val();
		
		if(val=="0"){
	
			contentFragment.attributeId=116;//认证时间
			contentFragment.content=$("#certTime").val();
			attr.dataType=0;//短文本
		
			contentFragment.attribute=attr;
			contentFragmentList.push(contentFragment);
			
			contentFragment.attributeId=41;//认证级别
			contentFragment.content=$("#select").val();
			attr.dataType=103;//字典码
		
			contentFragment.attribute=attr;
			contentFragmentList.push(contentFragment);
			
			contentFragment.attributeId=108;//认证编号
			contentFragment.content=$("#certCode").val();
			attr.dataType=0;//短文本
		
			contentFragment.attribute=attr;
			contentFragmentList.push(contentFragment);

		}
		
	
		//添加自定义 属性值
		
		var len =$("#tagContent").children("dl").length;
		
		if(len>4){
		
			$("#tagContent").children("dl").each(function(i,item){
			
				if(i>2&&i<len-1){
					var attrName="";
					var attrValue="";
					$(this).find("input").each(function(index,obj){
					
					
						if(index==0){
						
								if($(this).val()==""){
									alert("自定义信息名称不能为空！"); 
									$(this).focus();
									return false;
								}else{	
									attrName=$(this).val();
								}
								
						}else{
							if($(this).val()==""){
									alert("自定义信息值名称不能为空！"); 
									$(this).focus();
									return false;
								}else{	
									attrValue=$(this).val();
								}
						}	
						
					});
					
					contentFragment.attributeId=0;//认证级别
					contentFragment.content=attrValue;
					attr.dataType=0;//短字段
					attr.cnName=attrName;
			
					contentFragment.attribute=attr;
					contentFragmentList.push(contentFragment);
					
				}
		
			});
		}

		ich.contentFragmentList=contentFragmentList;
		
		
		///console.log(JSON.stringify(ich)); return false;
		
		$.ajax({
                type: "POST",
                url: serverPath+"/ichProject/saveIchProject",
                data:{params:JSON.stringify(ich)} ,
                dataType: "text",
                complete: function () { },
                success: function (result) {
				
						alert("success");
                },
                error: function (result, status) { 
				}
        });
		

	}
	//表单验证
	function vaidateForm(){
		if($("#chiName").val()==""){
			alert("请返回 填写中文名！");
			return false;
		}
		
		if($("#titu").val()==""){
			alert("请上传 图片！");
			return false;
		}

		var category = $("#categoryID").attr("value");
		
		if(typeof(category)=="undefined"){
			alert("请选择 项目分类！");
			return false;
		}else{
			$("#ichCategoryId").val(category)
		}

		if($("#dis_code").val()==""){
			alert("请填写申报地区！");
			return false;
		}
		
		if($("#summary").val()==""){
			alert("请填写简介！");
			return false;
		}
		
		if($("#pinyin").val()==""){
			alert("请填写拼音！");
			return false;
		}
	
		//判断是否选择 为已经认证项目
		 var val=$('input:radio[name="rz"]:checked').val();
            if(val==null){
                alert("请选择 是否为已认证项目!");
                return false;
            }
           
			
	}
	
	
	
	
</script>

</html>