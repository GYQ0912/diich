<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>搜索结果</title>
    <link rel="stylesheet" href="http://192.168.1.111/assets/css/common.css">
    <link rel="stylesheet" href="http://192.168.1.111/assets/css/layout.css">
    <script src="http://192.168.1.111/assets/js/jquery.min.js"></script>
    <script src="http://192.168.1.111/category.js"></script>
    <script src="http://192.168.1.111/citys.js"></script>
    <script src="http://192.168.1.111/keyword.js"></script>
    <script src="http://192.168.1.111/assets/js/doT.js"></script>
    <!--<script src="assets/js/system.js"></script>-->

    <script id="interpolationtmpl" type="text/x-dot-template">

        {{ for(var i=0, catlen=it.length; i<catlen; i++) { }} <li>
            {{?it[i].type == 0}}


            <a class="pic" href="project/{{=it[i].id }}.html">
                {{?it[i].img}}
                <img src="{{= it[i].img }}" alt="">
                {{??}}
                <img src="http://192.168.1.111/headsmall.png" alt="">
                {{?}}
            </a>

            <div class="context">
                <h4>{{= it[i].title }}<i class="icon_list_cate"></i></h4>
                <div class="doi">
                    <span class="tag">ID</span>
                    <span>标识码</span>
                    <span>{{= it[i].id }}</span>
                </div>
                <div class="cate">
                    <span>类别</span>
                    <span>{{= it[i].category }}</span>
                </div>
                <div class="brief">
                    {{= it[i].content }}
                </div>
            </div>

            {{??it[i].type == 1 }}


            <a class="pic">
                {{?it[i].img}}
                <img src="{{= it[i].img }}" alt="">
                {{??}}
                <img src="http://192.168.1.111/headsmall.png" alt="">
                {{?}}
            </a>
            <div class="context">
                <h4>{{= it[i].title }}<i class="icon_list_user"></i></h4>
                <div class="cate">
                    <a href="" class="icon_inter"><i></i>UNESCO认证</a>
                    {{?it[i].projjectName}}
                    <span class="name_project">{{= it[i].projjectName }}</span>
                    {{?}}

                </div>
                <div class="doi">
                    <span class="tag">ID</span>
                    <span>标识码</span>
                    <span>{{= it[i].id }}</span>
                </div>
                <div class="brief">
                    {{= it[i].content }}
                </div>
            </div>

            {{??}}


            <a href="" class="pic">
                {{?it[i].img}}
                <img src="{{= it[i].img }}" alt="">
                {{??}}
                <img src="http://192.168.1.111/headsmall.png" alt="">
                {{?}}
            </a>
            <div class="context">
                <h4>{{= it[i].title }}<i class="icon_list_album"></i></h4>
                <div class="info">
                    <a href=""><img src="{{= it[i].masters.uri}}" alt=""></a>
                    <span>{{= it[i].masters.name }}</span>
                    <span class="name_project">{{= it[i].category }}</span>
                </div>
                <div class="brief">
                    {{= it[i].content }}
                </div>
            </div>

            {{?}}

        </li>

        {{ } }}

    </script>


    <script>
        function searchData_() {

            $("#pageNum").val("1"); //把页面回执到1

            $.ajax({
                cache: true,
                type: "POST",
                url: "http://192.168.1.112:8080/s",
                data: $('#form').serialize(), // 你的formid
                dataType: "json",
                async: false,
                error: function(request) {
                    //alert("Connection error");
                },
                success: function(data) {

                    $("#totalCount").text(data.totalCount);
                    $("#totalCount_").text(data.totalCount);
                    var evalText = doT.template($("#interpolationtmpl").text());
                    $("#content").html(evalText(data.res));
                    $(".load_more").show();

                    if (parseInt($("#pageNum").val()) * parseInt($("#pageSize").val()) >= data.totalCount) {
                        $(".load_more").hide();
                    }else{
                        $(".load_more").show();
                    }
                }
            });
        }

        function searchData() {

            $.ajax({
                cache: true,
                type: "POST",
                url: "http://192.168.1.112:8080/s",
                data: $('#form').serialize(), // 你的formid
                dataType: "json",
                async: false,
                error: function(request) {
                    //alert("Connection error");
                },
                success: function(data) {
                    //alert(JSON.stringify(data.res));
                    $("#totalCount").text(data.totalCount);
                    $("#totalCount_").text(data.totalCount);
                    var evalText = doT.template($("#interpolationtmpl").text());
                    $("#content").html(evalText(data.res));
                    $(".load_more").show();
                }
            });
        }

        function loadmore() {
            var pageNum = $("#pageNum").val();
            $("#pageNum").val((parseInt(pageNum) + 1).toString());

            $.ajax({
                cache: true,
                type: "POST",
                url: "http://192.168.1.112:8080/s",
                data: $('#form').serialize(), // 你的formid
                dataType: "json",
                async: false,
                error: function(request) {
                    //alert("Connection error");
                },
                success: function(data) {
                    var evalText = doT.template($("#interpolationtmpl").text());
                    $("#content").append(evalText(data.res));

                    //判定 加载页面 是否可以再点击
                    if (parseInt($("#pageNum").val()) * parseInt($("#pageSize").val()) >= data.res.totalCount) {
                        $(".load_more").hide();
                    }
                }
            });
        }

        function resetForm() {

            $("#pageNum").val(1);
            $("#pageSize").val(6);
            $("#area_code").val("");
            $("#gb_category_code").val("");
            $("#type").val("");
        }





    </script>
</head>

<body style="background-color: rgb(245, 246, 247)">
<div class="header header_detail">
    <div class="content">
        <a class="logo" href=""></a>
        <div class="nav">
            <ul>
                <li class="active"><a href="http://192.168.1.111/index.html">首页</a></li>
                <li><a href="非遗名录.html">非遗名录</a></li>
                <li><a href="非遗大师.html">非遗大师</a></li>
                <li><a href="精选内容.html">精选内容</a></li>
                <li><a href="非遗资讯.html">非遗资讯</a></li>
                <li><a href="官方服务.html">官方服务</a></li>
                <li><a href="我要申报.html">我要申报</a></li>
            </ul>
        </div>
        <div class="info">
            <ul>
                <li class="login"><a class="active" href="javascript:;"><i class="icon"></i><em>登录</em></a></li>
                <li class="language">
                    <a class="zh active" href="javascript:;"><em>中文</em></a>
                    <a class="en" href="javascript:;"><em>EN</em></a>
                </li>
                <li class="search">
                    <i class="icon"></i>
                </li>
            </ul>
        </div>
    </div>
    <!--//End content-->
    <div class="drop_menu">
        <div class="content">
            <div class="item" style="width: 86px;">
                <dl>
                    <dt>口头传说和表述</dt>
                    <dd>
                        <a href="">语言</a>
                        <a href="">文字</a>
                        <a href="">口述</a>
                        <a href="">其他口头传统<br>及表述</a>
                    </dd>
                </dl>
            </div>
            <!--//End-->

            <div class="item" style="width: 143px;">
                <dl>
                    <dt>表演艺术</dt>
                    <dd>
                        <a href="">音乐演奏</a>
                        <a href="">舞蹈</a>
                        <a href="">民歌</a>
                        <a href="">传统戏剧</a>
                        <a href="">曲艺</a>
                        <a href="">传统体育、游艺与杂技</a>
                        <a href="">其他表演艺术</a>
                    </dd>
                </dl>
            </div>
            <!--//End-->

            <div class="item" style="width: 100px;">
                <dl>
                    <dt>社会风俗<br>礼仪、节庆</dt>
                    <dd>
                        <a href="">生产商贸习俗</a>
                        <a href="">生活习俗</a>
                        <a href="">人生仪式</a>
                        <a href="">节日庆典</a>
                        <a href="">其他仪式及庆典</a>
                    </dd>
                </dl>
            </div>
            <!--//End-->

            <div class="item" style="width: 240px;">
                <dl>
                    <dt>有关自然界和<br>宇宙的知识和实践</dt>
                    <dd>
                        <a href="" style="width: 72px;">农林牧畜渔</a>
                        <a href="" style="width: 129px; margin-left: 24px;">服装</a>
                        <a href="" style="width: 72px;">食品</a>
                        <a href="" style="width: 129px; margin-left: 24px;">住房与建筑</a>
                        <a href="" style="width: 72px;">交通</a>
                        <a href="" style="width: 129px; margin-left: 24px;">旅行</a>
                        <!--</dd>-->
                        <!--<dd>-->
                        <a href="" style="width: 72px;">医、药</a>
                        <a href="" style="width: 129px; margin-left: 24px;">军事防御</a>
                        <a href="" style="width: 72px;">商贸</a>
                        <a href="" style="width: 129px; margin-left: 24px;">工业、工程</a>
                        <a href="" style="width: 72px;">天文、地理、水文等</a>
                        <a href="" style="width: 129px; margin-left: 24px;">其他自然知识和实践</a>
                    </dd>
                </dl>
            </div>
            <!--//End-->

            <div class="item" style="width: 210px;">
                <dl>
                    <dt>传统的手工艺技能</dt>
                    <dd>
                        <a href="" style="width: 115px;">工具及机械制作</a>
                        <a href="" style="width: 66px; margin-left: 24px;">髹饰工艺</a>
                        <a href="" style="width: 115px;">家畜农林产品加工</a>
                        <a href="" style="width: 66px; margin-left: 24px;">织染工艺</a>
                        <a href="" style="width: 115px;">造纸、印刷机装裱</a>
                        <a href="" style="width: 66px; margin-left: 24px;">编扎工艺</a>
                        <a href="" style="width: 115px;">字画工艺</a>
                        <a href="" style="width: 66px; margin-left: 24px;">锻冶工艺</a>
                        <a href="" style="width: 115px;">剪刻工艺</a>

                        <a href="" style="width: 66px; margin-left: 24px;">雕塑工艺</a>
                        <a href="" style="width: 115px;">烧造工艺</a>
                        <a href="" style="width: 66px; margin-left: 24px;">木作工艺</a>
                        <a href="" style="width: 115px;">其他类</a>


                    </dd>
                </dl>
            </div>


        </div>
    </div>
    <!--//End drop_menu-->

</div>
<div class="filter_search">
    <div class="content">
        <form class="form" id="form">
            <input class="ipt" type="text" id="keyword" name="keyword" value="" autocomplete="off">
            <input type="hidden" id="pageNum" name="pageNum" value="1" />
            <input type="hidden" id="pageSize" name="pageSize" value="6" />
            <input type="hidden" id="area_code" name="area_code" value="" />
            <input type="hidden" id="gb_category_code" name="gb_category_code" value="" />
            <input type="hidden" id="type" name="type" value="" />
            <input class="submit" type="button" value="搜索" onclick="searchData()">
            <div class="suggest" style="display: none;">
                <ul id="words">
                    <!-- <li><a href=""><span>苏州</span>传承人</a></li>-->
                </ul>
            </div>
        </form>
        <!--//End form-->

        <div class="attr">
            <span id="attr_text">所属类别</span>
            <span id="area_text">全球</span>
        </div>
        <!--//End attribute-->

        <div class="dropbox" id="drag">
            <div class="item" id="item_1">
                <dl class="level">
                    <dt>
                    <div class="title">一级分类</div>
                    <div class="subtitle" >所有分类</div>
                    </dt>
                    <dd>
                        <ul id="mainCategory">

                        </ul>
                    </dd>
                </dl>
                <dl class="level2">
                    <dt>
                    <div class="title">二级分类</div>
                    <div class="subtitle" >所有二级分类</div>
                    </dt>
                    <dd>
                        <ul id="catecontent">

                        </ul>
                    </dd>
                </dl>
            </div>
            <!--//End 所属分类-->
            <div class="item" id="item_2">
                <dl class="level">
                    <dt>
                    <div class="title">位置</div>
                    </dt>
                    <dd>
                        <ul id="country">
                            <li>中国</li>
                        </ul>
                    </dd>
                </dl>
                <dl class="level2">
                    <dt>
                    <div class="title">按照字母顺序</div>
                    </dt>
                    <dd>
                        <ul id="citycontent">

                        </ul>
                    </dd>
                </dl>
            </div>
            <!--//End 位置-->
        </div>
        <!--//End attribute-->
    </div>
</div>
<!--//End filter_search -->

<!-- 找到项目 start -->
<div class="container">
    <div class="directory search">
        <div class="section">
            <div class="title"><span id="totalCount"></span>
                <p>找到结果</p>
            </div>
            <!--//End title-->
            <div class="filter_bar">
                <div class="links">
                    <a class="active" href="" id="totalCount_">全部</a>
                    <a href="">项目</a>
                    <a href="">传承人</a>
                    <a href="">作品</a>
                </div>
                <div class="icon_tab active"><i></i></div>
            </div>
            <!--//End bar-->

            <div class="pro_column3 active">
                <ul id="content">


                </ul>
            </div>
            <div class="load_more" style="display:none">
                <a href="javascript:void(0)" onclick="loadmore()">Load More</a>
            </div>
        </div>
        <!-- 项目 end -->

    </div>
</div>
<!-- 找到项目 end -->

<div class="bd footer">
    <div class="diich">
        <div class="hd">
            <p class="name"><span>DIICH</span><em>非遺國際</em></p>
            <p class="subname">2017 © EFeiYi. All rights reserved</p>
        </div>
    </div>
    <!--//End diich-->
    <div class="main">
        <div class="hd">
            <div class="lbox">
                <div><span>项目概况</span><em>tel：400-876-8766</em></div>
                <div><span>重大活动</span><em>email：efeiyi@efeiyi.com</em></div>
                <div><span>合作资源</span><em>地址：北京市东城区前门大街72&amp;74号二层</em></div>
                <div><span>业务体系</span><em>add：2Floor，72&amp;74,Qian Men ST.Dongcheng District,Beijing,China</em></div>
            </div>
            <!--//End lbox-->
            <div class="rbox">
                <div class="share">
                    <a href="" class="facebook" title="facebook"></a>
                    <a href="" class="twitter" title="twitter"></a>
                    <a href="" class="instagram" title="instagram"></a>
                    <a href="" class="linkedin" title="linkedin"></a>
                    <span class="code"><img src="assets/images/footer_code.png" alt=""></span>
                </div>
            </div>
        </div>
    </div>
    <!--//ENd main-->
</div>
<!--//End--footer-->

</body>
<script>

    //点击联想框 触发
    function submitForm(index){
        //$("#keyword").val($("#span_"+index).text());
        //$("#form").submit()
        $("#keyword").val($("#span_"+index).text());
        $(".suggest").hide();
        searchData_();
        // location.href="search1.html?keyword="+$("#span_"+index).text();
    }

    $(function() {

        $("#keyword").val(getQueryString("keyword"));
        $("#gb_category_code").val(getQueryString("gb_category_code"));
        searchData_();

        //
        $(".subtitle").on("click",function(){

            $("#item_1").hide();
            $("#item_2").hide();
            $("#attr_text").text("所属类别");
            $("#area_text").text("全球");

            $("#gb_category_code").val("");
            searchData_();

        });

        $("#keyword").keyup(function(){
            $(".suggest").hide();
            if($("#keyword").val()!=""){
                //查询匹配字符串
                $("#words").empty();
                var html="";
                var i=10;//满足数据条数
                var key = $("#keyword").val().length;
                $.each(keywords,function(index,content){

                    if(content.substring(0,key)==$("#keyword").val()){

                        html+="<li><a href=\"javascript:void(0)\" id=\"span_"+index+"\" onclick=\"submitForm("+index+")\"><span >"+$("#keyword").val()+"</span>";

                        if(content.length==key){
                            html+="</a></li>";
                        }else{
                            html+=content.substring(key)+"</a></li>";
                        }

                        i--;
                        if(i==0){
                            $("#words").append(html);
                            $(".suggest").show();
                            return false;
                        }
                    }

                } );
                if(i<10){
                    $("#words").append(html);
                    $(".suggest").show();
                }
            }
        });
        var mainCategory = $('#mainCategory');

        //初始化分类数据
        $.each(category_all, function(index, content) {
            mainCategory.append("<li data-id=\"" + content.gbCategory + "\" >" + content.name + "</li>");
        });

        mainCategory.find('li').on('click', function() {
            $("#attr_text").text($(this).html());
            $("#gb_category_code").val($(this).attr("data-id"));
            $("#item_1").hide();

            searchData_();
        });


        var searchPage = {
            init: function() {
                $('.header_detail .content .info li.search').hide();
                $('.header_detail .content .info li.login').addClass('line');
                this.filterBar();
                this.search();
            },
            filterBar: function() {
                var obj = $('.filter_bar');
                var linkTab = obj.find('a');
                var iconTab = obj.find('.icon_tab');
                var proColumn = $('.pro_column3'); //搜索列表

                //筛选
                linkTab.on('click', function() {
                    $(this).addClass('active').siblings('a').removeClass('active');

                    //刷新搜索结果页

                    if ($(this).index() == 0) {
                        $("#type").val("");
                    }
                    if ($(this).index() == 1) {
                        $("#type").val("0");
                    }
                    if ($(this).index() == 2) {
                        $("#type").val("1");
                    }
                    if ($(this).index() == 3) {
                        $("#type").val("2");
                    }

                    searchData_();

                    return false;
                });

                //切换图标
                iconTab.on('click', function() {
                    if ($(this).hasClass('active')) { //九宫格
                        $(this).removeClass('active');
                        proColumn.removeClass('active');
                    } else { //横排
                        $(this).addClass('active');
                        proColumn.addClass('active');
                    }
                });


            },
            search: function() {
                var filter = $('.filter_search'); //下拉搜索
                var filterFixed = $('.filter_search_fixed');
                var ipt = filter.find('.ipt');
                var iptVal = ipt.val();
                var filterAll = filter.find('.attr span'); //筛选项
                var filterItem = filter.find('.item'); //筛选下来框
                var suggest = filter.find('.suggest');
                var body = $('body');
                //获取焦点
                ipt.focus(function() {
                    $(this).val('');
                    body.append('<div class="overbg"></div>');
                });

                //失去焦点如果为空则显示原始值
                ipt.blur(function() {
                    var _val = $(this).val();
                    if (_val == '') {
                        $(this).val(iptVal);
                    }
                    $('.overbg').remove();
                });

                //2.点击筛选
                filterAll.on('click', function() {
                    var _this = $(this);
                    var _index = _this.index();
                    filterItem.eq(_index)
                        .css('left', parseInt(_this.position().left) + 'px')
                        .show()
                        .siblings('.item')
                        .hide();
                });

                filterItem.each(function() {
                    var _this = $(this);
                    var level = $(this).find('.level');
                    var level2 = $(this).find('.level2');
                    var _li = level.find('li'); //分类

                    _li.hover(function() {
                        $(this).addClass('active').siblings('li').removeClass('active');

                        $("#catecontent").empty();
                        $("#citycontent").empty();

                        if (typeof(category_all[$(this).index()].children) != "undefined") {
                            $.each(category_all[$(this).index()].children, function(index, content) {
                                $("#catecontent").append("<li data-id=\"" + content.gbCategory + "\" >" + content.name + "</li>");
                            });

                            //点击二级分类
                            $("#catecontent").find('li').on('click', function() {
                                filterAll.eq(0).text($(this).html());
                                _this.hide();
                                $("#gb_category_code").val($(this).attr("data-id"));
                                searchData_();
                            });
                        }

                        if (typeof(dic_arr) != "undefined") {
                            $.each(dic_arr, function(index, content) {
                                $("#citycontent").append("<li data-id=\"" + content.code + "\"  >" + content.name + "</li>");
                            });

                            //国家级
                            $("#country").find('li').on('click', function() {
                                filterAll.eq(1).text($(this).html());
                                _this.hide();
                            });

                            //一级城市
                            $("#citycontent").find('li').on('click', function() {
                                filterAll.eq(1).text($(this).html());
                                _this.hide();
                                $("#area_code").val($(this).attr("data-id"));
                                searchData_();
                            });
                        }

                        level2.show();

                    });


                });


                //点击一级类别

                //3.阻止点击自身关闭
                filter.on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });

                //4.点击自身之外的地方关闭下拉框
                $(document).on("click", function() {
                    filterItem.hide();
                    filterFixed.slideUp('fast');
                });

                //自动提示


                body.find('.overbg').on('click', function() {
                    filterItem.hide();
                    filterFixed.slideUp('fast');
                    suggest.hide();
                    $(this).remove();
                    body.css('overflow', '');
                });

            },
        };
        $('#keyword').keypress(function(e) {


            if (e.keyCode == 13) {
                //e.preventDefault();

                //$('.overbg').remove();
                //$("#area_code").val("");
                //$("#gb_category_code").val("");
                //$("#type").val("");

                //$("#item_1").text("所属类别");
                //$("#item_2").text("全球");
                //$('.filter_bar').find('a').each(function(i) {
                //    $('#keyword').blur();
                //    if (i.index == 0) {
                //        $(this).addClass('active').siblings('a').removeClass('active');
                //    }
                //    searchData_();
                //});
                resetForm();
                window.location = "search1.html?keyword=" + $("#keyword").val();

            }
        })
        searchPage.init();
    })

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if ( r != null ){
            return decodeURI(r[2]);
        }else{
            return null;
        }
    }
</script>

</html>